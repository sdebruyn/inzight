version: 2

models:
  - name: dim_dates
    description: A dimension table of dates
    columns:
      - name: day_type
        description: The type of day
        tests:
          - not_null
          - accepted_values:
              values:
                - weekend
                - weekday

  - name: dim_time
    description: A dimension table of time
    columns:
      - name: moment
        description: The timestamp
        tests:
          - not_null
          - unique
          - dbt_expectations.expect_column_values_to_be_increasing
      - name: hour
        description: The hour of the day
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 23
      - name: minute
        description: The minute of the hour
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 59
      - name: second
        description: The second of the minute
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_between:
              min_value: 0
              max_value: 59
      - name: start_of_hour
        description: The start of the hour
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_increasing:
              strictly: false
          - dbt_expectations.expect_column_distinct_count_to_equal:
              value: 24
      - name: start_of_minute
        description: The start of the minute
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_increasing:
              strictly: false
          - dbt_expectations.expect_column_distinct_count_to_equal:
              value: 1440
      - name: am_pm
        description: The part of the day as AM or PM
        tests:
          - not_null
          - accepted_values:
              values:
                - AM
                - PM
      - name: part_of_day
        description: '{{ doc("part_of_day") }}'
        tests:
          - not_null
          - accepted_values:
              values:
                - morning
                - afternoon
                - evening
                - night

  - name: fct_electricity
    description: Electricity usage data coming from Fluvius, by quarter
    columns:
      - name: from_timestamp
        description: Start of the quarter
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_increasing:
              strictly: false
      - name: to_timestamp
        description: End of the quarter
        tests:
          - not_null
          - dbt_expectations.expect_column_values_to_be_increasing:
              strictly: false
      - name: tariff
        description: Tariff used during the quarter
        tests:
          - not_null
          - accepted_values:
              values:
                - peak
                - offpeak
      - name: usage
        description: Electricity usage in kWh
        tests:
          - dbt_utils.at_least_one
      - name: injection
        description: Electricity injection in kWh
        tests:
          - dbt_utils.at_least_one
      - name: validated
        description: Whether the data has been validated by Fluvius (bool)
        tests:
          - not_null